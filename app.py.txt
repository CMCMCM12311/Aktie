import streamlit as st
import yfinance as yf
import plotly.graph_objects as go
import pandas as pd

# S√¶t siden op
st.set_page_config(page_title="Min Aktie-Tracker", layout="wide")

st.title("üìà Aktie-Sammenligning")
st.markdown("Indtast tickers (f.eks. **MSFT, MSTR**) og se hvordan de har fulgt hinanden!")

# Sidebar til valgmuligheder
with st.sidebar:
    st.header("Indstillinger")
    tickers_input = st.text_input("Tickers (adskilt af komma)", "MSFT, MSTR")
    start_date = st.date_input("Start dato", pd.to_datetime("2015-01-01"))
    normalize = st.checkbox("Normalis√©r (start begge p√• kurs 100)", value=True)

# Hent data
tickers = [t.strip().upper() for t in tickers_input.split(",")]
if tickers:
    with st.spinner('Henter data fra Yahoo Finance...'):
        data = yf.download(tickers, start=start_date)['Close']

    if not data.empty:
        # Hvis der kun er √©n ticker, laver yfinance en Series, vi vil have en DataFrame
        if len(tickers) == 1:
            data = data.to_frame()

        # Beregn normalisering hvis valgt
        if normalize:
            plot_data = (data / data.iloc[0]) * 100
            y_label = "Indekseret V√¶rdi (Start = 100)"
        else:
            plot_data = data
            y_label = "Pris i USD"

        # Lav den interaktive graf
        fig = go.Figure()
        for col in plot_data.columns:
            fig.add_trace(go.Scatter(x=plot_data.index, y=plot_data[col], name=col))

        fig.update_layout(
            hovermode="x unified",
            xaxis_title="√Ör",
            yaxis_title=y_label,
            template="plotly_dark", # Ser lidt mere 'fintech' ud
            legend=dict(yanchor="top", y=0.99, xanchor="left", x=0.01)
        )

        st.plotly_chart(fig, use_container_width=True)
        
        st.success("Brug musen til at markere et omr√•de (f.eks. omkring 2018) for at zoome ind p√• detaljerne!")
    else:
        st.error("Ingen data fundet. Tjek om dine tickers er rigtige.")